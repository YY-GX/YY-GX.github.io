---
import BaseLayout from '@components/layout/BaseLayout.astro';
import { getConfig } from '@lib/config';
import fs from 'node:fs';
import path from 'node:path';
import yaml from 'yaml';

const config = getConfig();
if (!config.pages.repositories) return Astro.redirect('/404');

let repos: any[] = [];
try {
  const reposPath = path.resolve(process.cwd(), 'src/content/repositories.yml');
  const data = yaml.parse(fs.readFileSync(reposPath, 'utf-8'));
  repos = data.repositories || [];
} catch {}
---

<BaseLayout title="Repositories" description="Open source projects">
  <div class="animate-on-scroll"><h1 class="text-3xl font-bold mb-8">Repositories</h1></div>
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    {repos.map(repo => (
      <a href={repo.url} target="_blank" rel="noopener noreferrer" class="p-5 rounded-xl bg-[var(--color-card-bg)] border border-[var(--color-border)] card-hover block animate-on-scroll">
        <h3 class="font-medium text-[var(--color-accent)]">{repo.name}</h3>
        <p class="text-sm text-[var(--color-text-secondary)] mt-1">{repo.description}</p>
        <div class="mt-3 flex items-center gap-4 text-xs text-[var(--color-text-secondary)]">
          {repo.language && <span class="flex items-center gap-1"><span class="w-2.5 h-2.5 rounded-full bg-[var(--color-accent)]"></span>{repo.language}</span>}
          {repo.stars && <span>&#9733; {repo.stars}</span>}
        </div>
      </a>
    ))}
  </div>
  {repos.length === 0 && <p class="text-[var(--color-text-secondary)] text-center py-12">Add repositories to src/content/repositories.yml.</p>}
</BaseLayout>
